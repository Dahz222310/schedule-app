<script>
    // Объявляем переменную prefs
    let prefs = {};

    // При загрузке страницы загружаем данные из localStorage
    window.onload = () => {
        generateDays();

        const savedPrefs = localStorage.getItem("schedule_prefs");
        if (savedPrefs) {
            prefs = JSON.parse(savedPrefs);
        }
    };

    function generateDays() {
        const days = document.getElementById("days");
        days.innerHTML = "";
        for (let d = 1; d <= 28; d++) {
            const day = document.createElement("div");
            day.innerHTML = `
                <label>
                    <input type="checkbox" data-day="${d}">
                    ${d}.02
                </label>
            `;
            days.appendChild(day);
        }
    }

    function savePreferences() {
        const name = document.getElementById("emp_name").value.trim();
        const position = document.getElementById("emp_position").value.trim();
        const month = document.getElementById("month").value;

        if (!name) {
            alert("Введите своё имя");
            return;
        }

        const selectedDays = [];
        document.querySelectorAll("#days input[type='checkbox']:checked").forEach(cb => {
            selectedDays.push(cb.dataset.day);
        });

        prefs[name] = {
            name,
            position,
            month,
            days: selectedDays
        };

        // Сохраняем prefs в localStorage
        localStorage.setItem("schedule_prefs", JSON.stringify(prefs));

        alert("Пожелания сохранены!");
    }

    function showManagerView() {
        const managerView = document.getElementById("manager_view");
        managerView.innerHTML = "<h3>Пожелания сотрудников</h3>";

        if (Object.keys(prefs).length === 0) {
            managerView.innerHTML += "<p>Пока нет пожеланий.</p>";
            return;
        }

        Object.keys(prefs).forEach(empName => {
            const emp = prefs[empName];
            const div = document.createElement("div");
            div.innerHTML = `
                <strong>${emp.name} (${emp.position})</strong>: 
                ${emp.days.join(", ")} дней в ${emp.month}
            `;
            managerView.appendChild(div);
        });
    }
</script>
